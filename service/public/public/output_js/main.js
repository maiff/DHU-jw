var Q=function(t,e,o,n,a,i,l,s,c,r,d,u,h){return n=e.getElementsByTagName("html")[0],d=[],u="!",onhashchange=function(){for(h.hash=a=location.hash.substring(u.length+1),l=a.split("/"),c=d.length;c--;)if(s=a.match(d[c])){l[0]=d[c];break}h[l[0]]||(l[0]=r),h.pop&&h.pop.apply(t,l),h.lash=i=l.shift(),n.setAttribute("view",i),h[i].apply(t,l)},h={init:function(t){return void 0!==t.key&&(u=t.key),r=t.index||"V",t.pop&&"function"==typeof t.pop&&(h.pop=t.pop),onhashchange(),this},reg:function(t,e){if(t){if(void 0==e&&(e=function(){}),t instanceof RegExp)h[t]=e,d.push(t);else if(t instanceof Array)for(var o in t)L=[].concat(t[o]).concat(e),this.reg.apply(this,L);else"string"==typeof t&&("function"==typeof e?h[t]=e:"string"==typeof e&&h[e]&&(h[t]=h[e]));return this}},V:function(){return console.log("Q.js <https://github.com/itorr/q.js> 2014/12/28"),this},go:function(t){return location.hash="#"+u+t,this}}}(this,document),common_page_now_show={ele:null};common_page_now_show.push=function(t){this.ele=t},common_page_now_show.show=function(){this.ele?this.ele.show():null},common_page_now_show.hide=function(){this.ele?this.ele.hide():null};var common_page=function(t){this._main=$("<div>",{class:"all",id:t.id});var e='<nav ><div class="container"><a href="#!home"><img src="./public/img/arrow.png" class="return" ></a></div></nav>';this._main.html(e),$("<div>",{class:"container"}).html(t.content).appendTo(this._main),this._main.appendTo("body")};common_page.prototype.show=function(){common_page_now_show.hide(),common_page_now_show.push(this._main),common_page_now_show.show()};var tool=function(){function t(t){if(document.cookie.length>0&&(c_start=document.cookie.indexOf(t+"="),c_start!=-1))return c_start=c_start+t.length+1,c_end=document.cookie.indexOf(";",c_start),c_end==-1&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))}function e(t,e,o){var n=new Date;n.setDate(n.getDate()+o),document.cookie=t+"="+escape(e)+(null==o?"":";expires="+n.toGMTString())}function o(){var t=document.cookie.match(/[^ =;]+(?=\=)/g);if(t)for(var e=t.length;e--;)document.cookie=t[e]+"=0;expires="+new Date(0).toUTCString()}function n(){$(".loading-container").show()}function a(){$(".loading-container").hide()}var i="";return{getCookie:t,setCookie:e,clearCookie:o,loadingShow:n,loadingHide:a,needLoginFromHash:i}}(),ahelp=function(){function t(t,e){var o=t[0].indexOf("=")+1,n=t[0].length;tool.setCookie("userid",t[0].slice(o,n),e)}function e(t,e){var o=t[2].indexOf("=")+1,n=t[2].length;tool.setCookie("loginname",t[2].slice(o,n).trim(),e)}function o(){return!!tool.getCookie("userid")}function n(){return!!o()||(Materialize.toast("请登录!",4e3),tool.needLoginFromHash=window.location.hash,window.location="#!login",!1)}return{setUserId:t,setloginname:e,isLogined:o,noLoginToLogin:n}}(),home=function(){function t(){Q.reg("home",function(){common_page_now_show.hide(),common_page_now_show.push($("#main-container")),common_page_now_show.show(),ahelp.isLogined()?($("#nav-mobile a span.name").text(tool.getCookie("username")).parent().attr("href","#"),$("#nav-mobile a span.loginout").text("").parent().off("click"),$("#nav-mobile a span.loginout").text("退出登录").parent().click(e),141320231==tool.getCookie("id")&&$("#nav-mobile").append('<li><a href="#!getStuInfo"></a></li>')):($("#nav-mobile a span.name").text("请登录").parent().attr("href","#!login"),$("#nav-mobile a span.loginout").text("").parent().off("click"))}),$.get("/home",function(t){console.log(t);for(var e=$(".home-collection li"),o=e.length,n=0;n<o;n++)$(e[n]).children().attr("href","#!u/"+t[n].link),$(e[n]).children().html(t[n].text+"<span>"+t[n].time+"</span>")}),$.get("/maiffInformation",function(t){console.log(t);for(var t=JSON.parse(t),e=$(".maiff-collection"),o=t.length,n=0;n<o;n++){var a=$("<li>"),i=$("<a>").attr("href","#!m/"+t[n]._id).addClass("collection-item waves-effect waves-teal");i.html(t[n].title+"<span>"+t[n].time+"</span>"),a.append(i),e.append(a)}})}function e(){tool.clearCookie(),Materialize.toast("退出成功",4e3),window.location="#!login",window.location="#!home"}return{router_home:t}}(),login=function(){function t(){Q.reg("login",function(){n.show(),$(".button-collapse").sideNav("hide")}),$("#login").click(function(){var t=$("#isSaveLogin").prop("checked");tool.loadingShow(),$.ajax({type:"post",url:"/login",data:{usename:$("#usename").val(),password:$("#password").val()},success:function(n){console.log(n),n.length>1?e(n,t):o()}}),$(this).attr("disable","true")})}function e(t,e){var o=e?30:null;tool.setCookie("id",$("#usename").val(),o),tool.loadingHide(),Materialize.toast("登录成功",4e3),ahelp.setUserId(t,o),ahelp.setloginname(t,o),$.post("/getName",function(t){tool.setCookie("username",t,o),$("#nav-mobile a span.name").text(t).parent().attr("href","#")}),$("#login").attr("disable","false"),window.location=tool.needLoginFromHash||"#!home"}function o(){tool.loadingHide(),Materialize.toast("登录失败",4e3)}var n=new common_page({id:"login-container",content:'<h2 class="header">请输入教务处账号密码登录</h2><form ><div class="input-field col s6"><input id="usename" type="text" class="validate" name="usename"><label for="usename">学号</label></div><div class="input-field col s6"><input id="password" type="password" class="validate" name="password"><label for="password">教务处密码</label></div> <p><input type="checkbox" id="isSaveLogin" /><label for="isSaveLogin">30天记住我</label></p><button class="btn waves-effect waves-light" type="button" name="action" id="login">登录</button></from>'});return{router_login:t}}(),detail=function(){function t(){Q.reg("u",function(t){tool.loadingShow(),$.get("/u?q="+t.match(/\d+/g),function(t){e.show(),$("#article-container .header").text(t.title),$("#article-container .content  div").html(t.content),tool.loadingHide()})})}var e=new common_page({id:"article-container",content:'<h4 class="header"></h4><div class="content"><div></div></div>'});return $("#article-container a").removeAttr("href").click(function(){history.go(-1)}),{router_u:t}}(),getScore=function(){function t(){Q.reg("score",function(){o.show(),$(".button-collapse").sideNav("hide"),ahelp.noLoginToLogin()&&(tool.loadingShow(),e())})}function e(){$.post("/getScore",function(t){var e=JSON.parse(t).scoreLists,o="";for(var n in e)o+="<tr><td>"+e[n].name+"</td><td>"+e[n].credit+"</td><td>"+e[n].score+"</td></tr>";$("#score-container table tbody").html(o),tool.loadingHide()})}var o=new common_page({id:"score-container",content:'<h2 class="header">本学期成绩</h2><table class="striped "><thead><tr><th >课程名称</th><th >学分</th><th >成绩</th></tr></thead><tbody></tbody></table>'});return{router_score:t}}(),getCourseTable=function(){function t(){Q.reg("courseTable",function(){$(".button-collapse").sideNav("hide"),ahelp.noLoginToLogin()&&(o.show(),tool.loadingShow(),e(),$("#tremSelect").change(function(){e($(this).val())}))})}function e(t){$.post("/getCourseTable",{tr:t},function(t){$("#courseTable").html(t),tool.loadingHide()})}var o=new common_page({id:"courseTable-container",content:'<form><div class="input-field col s12"><select id="tremSelect"><option value="" disabled selected>20162017a</option><option value="20152016s">20152016s</option><option value="20162017a">20162017a</option><option value="20162017s">20162017s</option></select></div></form><h2 class="header">本学期课表</h2><table class=" bordered" ><tbody id="courseTable"></tbody></table>'});return{router_courseTable:t}}(),getGymCount=function(){function t(){Q.reg("gymCount",function(){$(".button-collapse").sideNav("hide"),ahelp.noLoginToLogin()&&(o.show(),tool.loadingShow(),e(tool.getCookie("id")))})}function e(t){console.log(t),$.post("/getGymCount",{stuId:t},function(t){"<tr></tr><tr></tr>"==t&&(t="<tr><td>啊偶！可能体育部的网站炸了，稍后重试~</td></tr>"),$("#gymCount").html(t),tool.loadingHide()})}var o=new common_page({id:"gymCount-container",content:'<h2 class="header">本学期体锻情况</h2><table class=" bordered" ><tbody id="gymCount"></tbody></table>'});return{router_gymCount:t}}(),getCourse=function(){function t(){Q.reg("getCourse",function(){$(".button-collapse").sideNav("hide"),ahelp.noLoginToLogin()&&(o.show(),tool.loadingShow(),e())})}function e(t){$.post("/getCourse",function(t){$("#course").html(t),tool.loadingHide()})}var o=new common_page({id:"courseTable-container",content:'<h2 class="header">本学期已选课程</h2><table class=" bordered" ><thead><tr><th >课程代码</th><th >课程名称</th><th >学分</th><th >任课教师</th><th >上课周次</th><th >上课时间</th><th >上课地点</th></tr></thead><tbody id="course"></tbody></table>'});return{router_course:t}}(),feedback=function(){function t(){Q.reg("feedback",function(){$(".button-collapse").sideNav("hide"),o.show()}),$("#feedback").click(function(){e()?Materialize.toast("反馈内容不能为空！",4e3):($(this).attr("disabled","true"),$.ajax({type:"post",url:"/feedback",data:{email:$("#email").val(),content:$("#textarea").val()},success:function(t){Materialize.toast("反馈成功，我们会及时处理~",4e3),$("#feedback").removeAttr("disabled"),window.location="#!home"}}))})}function e(){return""==$("#textarea").val()}var o=new common_page({id:"courseTable-container",content:'<h2 class="header">反馈建议</h2><form ><div class="input-field col s6"><input id="email" type="email" class="validate"><label for="email">Email</label></div><div class="input-field col s6"><textarea id="textarea" class="materialize-textarea"></textarea><label for="textarea">这里填您的意见</label></div><button class="btn waves-effect waves-light" type="button" name="action" id="feedback">提交</button></from>'});return{router_feedback:t}}(),getHowMuchBirSame=function(){function t(){Q.reg("sameBir",function(){$(".button-collapse").sideNav("hide"),ahelp.isLogined()?(n.show(),tool.loadingShow(),$("#logined-bir").show(),$("#noLogin-bir").hide(),e(tool.getCookie("id"))):(tool.needLoginFromHash=window.location.hash,n.show(),$("#logined-bir").hide(),$("#noLogin-bir").show())})}function e(t){$.ajax({type:"post",url:"/getSameBirth",data:{studentNo:t},success:function(t){console.log(t);var e=t.base_info;$("#birthday").text(e.birthday),$("#sameBirNum").text(Number(e.count)-1),$("#share-info").html("不好意思目前没人共享信息，赶紧把为这个网页共享出去，让大家都参与进来，祝你早日找到那么有缘的人。");var o=t.detail_info;if(0!=o.length){for(var n="",a=0;a<o.length;a++)n="<tr><td>"+o[a].name+"</td><td>"+o[a].studentNo+"</td><td>"+o[a].contact+"</td><tr>";$("#share-info").html(),$("#share-info").html(n)}tool.loadingHide()}})}var o='<div id="logined-bir"><h3 class="header">你的出生年月日是<span id="birthday"></span></h3><h4>全校一共有<span id="sameBirNum">0</span>个跟你同年同月同日生</h4><div class="row"><div class="col s12 m5"><div class="card-panel"><h5>下面是跟你同年同月同日生的且公开自己信息的人</h5><table id="share-info"></table></div></div></div><form ><div class="input-field col s6"><input id="contact" type="text"  class="validate"><label for="contact">联系方式</label><p>当然你可以选择不留，直接提交，那样只会显示你的姓名，学号。</p></div><button class="btn waves-effect waves-light" type="button" name="action" id="share">我来共享</button></from><div class="row"><div class="col s12 m5"><div class="card-panel"><h5>免责声明</h5><span class="">所有信息都是私密的不会公开（除非你同意公开），同时maiff通过合法手段用大量爬虫爬取的数据得到的结果。</span></div></div></div><!-- JiaThis Button BEGIN --><div class="jiathis_style_m"></div><script type="text/javascript" src="http://v3.jiathis.com/code/jiathis_m.js" charset="utf-8"></script><!-- JiaThis Button END --></div><div id="noLogin-bir"><h5>用教务处的账号密码登录，可以查看全校和你同年同月同日生的人的个数，当然你可以选择共享你的信息，让你们找到对方，快来登录吧。</h5><a href="#!login">立即去登陆</a>',n=new common_page({id:"birSame-container",content:o});return $("#share").click(function(){$.ajax({type:"post",url:"/postShare",data:{studentNo:tool.getCookie("id")},success:function(t){Materialize.toast("分享成功",4e3),$("#login").attr("disable","false")}}),$.ajax({type:"post",url:"/postContact",data:{studentNo:tool.getCookie("id"),contact:$("#contact").val()},success:function(t){$("#login").attr("disable","false")}}),$(this).attr("disable","true")}),{router_sameBir:t}}(),getStuInfo=function(){function t(){Q.reg("getStuInfo",function(){ahelp.noLoginToLogin(),n.show(),$(".button-collapse").sideNav("hide"),$("#getStuInfo_btn").click(function(){tool.loadingShow(),e()})})}function e(){$.ajax({type:"post",url:"/getStuInfo",data:{SELECT:$("#SELECT").val(),value:$("#s_value").val(),get_info_SELECT:$("#get_info_SELECT").val()},success:function(t){var t=JSON.parse(t);console.log(t),tool.loadingHide(),o(t)}})}function o(t){var e=0;for(var o in t[0])console.log(t[0]),$("#getStuInfo_table tr th").eq(e).text(o),e++;for(var n="",a=0;a<t.length;a++){var i="";for(var l in t[a])i+="<td>"+t[a][l]+"</td>";n+="<tr>"+i+"</tr>"}$("#getStuInfo_table tbody").html(n)}var n=new common_page({id:"score-container",content:'<h2 class="header">本学期成绩</h2><form ><div class="input-field col s6"><input id="SELECT" type="text" class="validate" name="SELECT"><label for="SELECT">查询子段</label></div><div class="input-field col s6"><input id="s_value" type="text" class="validate" name="s_value"><label for="s_value">查询值</label></div><div class="input-field col s6"><input id="get_info_SELECT" type="text" class="validate" name="get_info_SELECT"><label for="get_info_SELECT">想要得到的字段值</label></div><button class="btn waves-effect waves-light" type="button" name="action" id="getStuInfo_btn">提交</button></from><table class="striped" id="getStuInfo_table"><thead><tr><th >SELECT</th><th >s_value</th><th >get_info_SELECT</th></tr></thead><tbody></tbody></table>'});return{router_getStuInfo:t}}(),getDown=function(){function t(){Q.reg("getDown",function(){o.show(),$(".button-collapse").sideNav("hide"),tool.loadingShow(),e()})}function e(){$.get("/getDownCatalog",function(t){console.log(typeof t);for(var e=$(".down-collection"),o=t.length,n=0;n<o;n++){var a=$("<li>"),i=$("<a>").attr("href","#!u/"+t[n].link).addClass("collection-item waves-effect waves-teal");i.html(t[n].text+"<span>"+t[n].time+"</span>"),a.append(i),e.append(a)}tool.loadingHide()})}var o=new common_page({id:"down-container",content:'<h2 class="header">学生下载:</h2><form ><div class="input-field col s6"><input id="detail_key" type="text" class="validate" name="q"><label for="detail_key">输入查找的字段</label></div><button class="btn waves-effect waves-light" type="button" name="action" id="deail-search">查询</button></from><ul class="down-collection collection"></ul>'});return $("#deail-search").click(function(){tool.loadingShow(),$.post("./byKeyGetDetail",{q:$("#detail_key").val()},function(t){console.log(typeof t);var e=$(".down-collection");if(0!=t.length){e.html("");for(var o=t.length,n=0;n<o;n++){var a=$("<li>"),i=$("<a>").attr("href","#!u/"+t[n].link).addClass("collection-item waves-effect waves-teal");i.html(t[n].title+"<span></span>"),a.append(i),e.append(a)}}else e.html("没有找到相关内容～");tool.loadingHide()})}),{router_down:t}}(),maiff_detail=function(){function t(){Q.reg("m",function(t){console.log(t),tool.loadingShow(),$.get("/m?q="+t,function(t){console.log(t),e.show(),$("#maiff_article-container .header").text(t.title),$("#maiff_article-container .content  div").html(t.content),tool.loadingHide()})})}var e=new common_page({id:"maiff_article-container",content:'<h4 class="header"></h4><div class="content"><div></div></div>'});return{router_m:t}}(),maiffArticle=function(){function t(){Q.reg("newA",function(){$(".button-collapse").sideNav("hide"),o.show()}),$("#newMaiff").click(function(){e()?Materialize.toast("反馈内容不能为空！",4e3):($(this).attr("disabled","true"),$.ajax({type:"post",url:"./newMaiffArticle",data:{title:$("#maiff-title").val(),content:$("#maiff-textarea").val()},success:function(t){Materialize.toast("写成功了~",4e3),$("#feedback").removeAttr("disabled"),window.location="#!home"}}))})}function e(){return""==$("#maiff-textarea").val()}var o=new common_page({id:"courseTable-container",content:'<h2 class="header">来写你的内容吧～</h2><form ><div class="input-field col s6"><input id="maiff-title" type="text" class="validate"><label for="maiff-title">title</label></div><div class="input-field col s6"><textarea id="maiff-textarea" class="materialize-textarea"></textarea><label for="maiff-textarea">来写你的内容吧</label></div><button class="btn waves-effect waves-light" type="button" name="action" id="newMaiff">提交</button></from>'});return{router_maiffArticle:t}}();!function(){home.router_home(),login.router_login(),detail.router_u(),getScore.router_score(),getCourseTable.router_courseTable(),getGymCount.router_gymCount(),getCourse.router_course(),feedback.router_feedback(),getHowMuchBirSame.router_sameBir(),getStuInfo.router_getStuInfo(),getDown.router_down(),maiff_detail.router_m(),maiffArticle.router_maiffArticle(),Q.init({key:"!",index:"home",pop:function(t){console.log("pop 当前参数是:"+t)}}),$(".button-collapse").sideNav(),$(document).ready(function(){$("select").material_select(),$(".collapsible").collapsible({accordion:!1})})}();